# -----------------------------------------
# 🎙️ Proxy Reverso para WebSocket (Ratchet)
# -----------------------------------------

# Ativa reescrita
RewriteEngine On

# 🔸 Redireciona conexões WebSocket do navegador (WSS → WS interno)
RewriteCond %{HTTP:Upgrade} =websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^nave/voice/?$ ws://127.0.0.1:8080/ [P,L]

# 🔸 Mantém HTTPS ativo e força SSL no restante do site
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 🔸 Cabeçalhos para manter a conexão ativa
Header always set Connection keep-alive
Header always set Upgrade $http_upgrade
Header always set Access-Control-Allow-Origin "*"

# 🔸 Compactação normal do site
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
